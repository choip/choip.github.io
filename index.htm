<!DOCTYPE html>
<html>
<head>
    <style>
        #map {
            height: 800px;
            width: 100%;
        }
    </style>
</head>
<body>
    <div id="floating-panel">
        <b>Start: </b>
        <select id="start">
            <option value="13.051828, 80.251548">Consulate Main</option>
            <option value="13.045188, 80.255144">Kumara Guru</option>
            <option value="13.031430655221271, 80.24697705546839">River House</option>
            <option value="13.026005158148841, 80.24584116441804">TBR 2</option>
            <option value="13.026245500000005, 80.2455354">TBR 3</option>
            <option value="13.026453300000018, 80.24532880000004">TBR 4</option>
            <option value="13.021122300000021, 80.2424575">Atrium</option>
            <option value="13.029773300000002, 80.24819079999997">KANNAN APT 1A</option>
            <option value="13.031741000000018, 80.24701060000007">FLAME</option>
            <option value="13.021915400000012, 80.25604429999999">Lincoln Lower</option>
            <option value="13.046289, 80.256254">Nandos</option>
            <option value="13.044619, 80.255564">Darios</option>
        </select>
        <b>End: </b>
        <select id="end">
            <option value="13.051828, 80.251548">Consulate Main</option>
            <option value="13.045188, 80.255144">Kumara Guru</option>
            <option value="13.031430655221271, 80.24697705546839">River House</option>
            <option value="13.026005158148841, 80.24584116441804">TBR 2</option>
            <option value="13.026245500000005, 80.2455354">TBR 3</option>
            <option value="13.026453300000018, 80.24532880000004">TBR 4</option>
            <option value="13.021122300000021, 80.2424575">Atrium</option>
            <option value="13.029773300000002, 80.24819079999997">KANNAN APT 1A</option>
            <option value="13.031741000000018, 80.24701060000007">FLAME</option>
            <option value="13.021915400000012, 80.25604429999999">Lincoln Lower</option>
            <option value="13.046289, 80.256254">Nandos</option>
            <option value="13.044619, 80.255564">Darios</option>
        </select>
    </div>
    <!-- <h3>My Google Maps Demo</h3> -->
    <div id="map"></div>
    <script>
        var markers_Chennai_CG = {
            position: { lat: 13.051828, lng: 80.251548 },
            type: 'Office',
            description: 'Consulate Main',
        };

        var markers_Chennai = [
          {
            position: { lat: 13.051828, lng: 80.251548 },
            type: 'Office',
            description: 'Consulate Main',
            
          },
          {
              position: { lat: 13.045188, lng: 80.255144 },
              type: 'Residence',
              description: 'Kumara Guru',
          },
          {
              position: { lat: 13.031430655221271, lng: 80.24697705546839 },
              type: 'Residence',
              description: 'River House',
          },
          {
              position: { lat: 13.026005158148841, lng: 80.24584116441804 },
              type: 'Residence',
              description: 'TBR 2',
          },
          {
              position: { lat: 13.026245500000005, lng: 80.2455354 },
              type: 'Residence',
              description: 'TBR 3',
          },
          {
              position: { lat: 13.026453300000018, lng: 80.24532880000004 },
              type: 'Residence',
              description: 'TBR 4',
          },
          {
              position: { lat: 13.021122300000021, lng: 80.2424575 },
              type: 'Residence',
              description: 'Atrium',
          },
          {
              position: { lat: 13.029773300000002, lng: 80.24819079999997 },
              type: 'Residence',
              description: 'Kannan APT',
          },
          {
              position: { lat: 13.031741000000018, lng: 80.24701060000007 },
              type: 'Residence',
              description: 'Flame',
          },
          {
              position: { lat: 13.021915400000012, lng: 80.25604429999999 },
              type: 'Residence',
              description: 'Lincoln Lower',
          },
          {
              position: { lat: 13.046289, lng: 80.256254 },
              type: 'Restaurent',
              description: 'Nandos',
          },
          {
              position: { lat: 13.044619, lng: 80.255564 },
              type: 'Restaurent',
              description: 'Dario',
          },
        ];

        var markertImageBase = 'http://maps.google.com/mapfiles/kml/pal3/';
        var markerImage = {
            Residence: {
                icon: markertImageBase + 'icon56.png'
            },
            Office: {
                icon: markertImageBase + 'icon21.png'
            },
            Restaurent: {
                icon: markertImageBase + 'icon55.png'
            }
        };

        var map, infoWindow, marker, currentPosition;

        function initMap() {

            var directionsService = new google.maps.DirectionsService;
            var directionsDisplay = new google.maps.DirectionsRenderer;

            infoWindow = new google.maps.InfoWindow({
                pixelOffset: new google.maps.Size(0,-30)
            });

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: markers_Chennai_CG.position,
            });

            directionsDisplay.setMap(map);

            //locateCurrentPosition();
            
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                  currentPosition = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                  };
                  infoWindow.setPosition(currentPosition);
                  infoWindow.setContent('Location found.');
                  infoWindow.open(map);
                  map.setCenter(currentPosition);

                  setMarkers(true);

                }, function () {
                  setMarkers(false);
                  handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                setMarkers(false);
                
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }

            var onChangeHandler = function () {
                calculateAndDisplayRoute(directionsService, directionsDisplay);
            };

            document.getElementById('start').addEventListener('change', onChangeHandler);
            document.getElementById('end').addEventListener('change', onChangeHandler);
        }

        function setMarkers(gotCurrentPosition) {
          markers_Chennai.forEach(function (markers_Chennai) {
              marker = new google.maps.Marker({
                  position: markers_Chennai.position,
                  // label: markers_Chennai.description,
                  icon: markerImage[markers_Chennai.type].icon,
                  map: map
              });
          
              var infoWindowContent;
              if (gotCurrentPosition) {
                infoWindowContent = markers_Chennai.description + '<p></p><a href="https://www.google.com/maps/dir/?api=1&origin=' + currentPosition.lat + ',' + currentPosition.lng + '&destination=' + markers_Chennai.position.lat + ',' + markers_Chennai.position.lng + '&travelmode=driving" target="_blank">Direction from Current Location</a>';
              }else{
                infoWindowContent = markers_Chennai.description + '<p></p><a href="https://www.google.com/maps/dir/?api=1&origin=' + String(markers_Chennai_CG.position.lat) + ',' + String(markers_Chennai_CG.position.lng) + '&destination=' + markers_Chennai.position.lat + ',' + markers_Chennai.position.lng + '&travelmode=driving" target="_blank">Direction from Current Location</a>';
              }
              marker.addListener('mouseover', function () {
                  infoWindow.setPosition(markers_Chennai.position);
                  infoWindow.setContent(infoWindowContent);
                  infoWindow.open(map);
              });
              marker.addListener('mouseout', function () {
                  // infoWindow.close();
              });
          });
        }

        function locateCurrentPosition() {
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function (position) {
                    var pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    infoWindow.setPosition(pos);
                    infoWindow.setContent('Location found.');
                    infoWindow.open(map);
                    map.setCenter(pos);
                }, function () {
                    handleLocationError(true, infoWindow, map.getCenter());
                });
            } else {
                // Browser doesn't support Geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }

        function calculateAndDisplayRoute(directionsService, directionsDisplay) {
            directionsService.route({
                origin: document.getElementById('start').value,
                destination: document.getElementById('end').value,
                travelMode: 'DRIVING'
            }, function (response, status) {
                if (status === 'OK') {
                    directionsDisplay.setDirections(response);
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        }

        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ?
              'Error: The Geolocation service failed.' :
              'Error: Your browser doesn\'t support geolocation.');
            infoWindow.open(map);
        }

    </script>
    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAsAduur2QPUWBMNEhKNG5cFwVy4wAJf5g&callback=initMap">
    </script>
</body>
</html>